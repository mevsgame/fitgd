<div class="equipment-edit-dialog">
  {{!-- Header --}}
  <div class="dialog-header">
    {{#if (eq mode 'create')}}
    <p class="info-notice">üì¶ Create a new equipment item for this character</p>
    {{else}}
    <p class="info-notice">üì¶ Configure equipment stats and modifiers</p>
    {{/if}}

    {{!-- Player tier restriction warning --}}
    {{#unless isGM}}
    {{#unless canEditTier}}
    <div class="warning-notice">
      ‚ö†Ô∏è You can only create or edit Common tier equipment. Rare and Epic items are GM-controlled.
    </div>
    {{/unless}}
    {{/unless}}
  </div>

  {{!-- Equipment Form --}}
  <form class="equipment-form">
    {{#if restrictedCreation}}
    {{!-- Simplified Form for Players --}}
    <div class="form-row">
      <div class="form-group">
        <label>Name <span class="required">*</span></label>
        <input type="text" name="name" value="{{equipment.name}}" maxlength="50" required />
        <p class="help-text">Equipment name (max 50 characters)</p>
      </div>
      <div class="form-group">
        <label>Slots <span class="required">*</span></label>
        <input type="number" name="slots" value="{{#if equipment.slots}}{{equipment.slots}}{{else}}1{{/if}}" min="1"
          required />
        <p class="help-text">Load slots occupied</p>
      </div>
    </div>

    <div class="form-group">
      <label>Type <span class="required">*</span></label>
      <div class="type-selection">
        <label class="type-option">
          <input type="radio" name="restrictedType" value="active" checked>
          <div>
            <strong>Active</strong> <span style="color: #4caf50">(+1d check)</span>
          </div>
        </label>
        <label class="type-option">
          <input type="radio" name="restrictedType" value="passive">
          <div>
            <strong>Passive</strong> <span style="color: #4caf50">(+1d check)</span>
          </div>
        </label>
        <label class="type-option">
          <input type="radio" name="restrictedType" value="consumable">
          <div>
            <strong>Consumable</strong> <span style="color: #2196f3">(+1d, +1 pos)</span>
          </div>
        </label>
      </div>
      <p class="help-text">Players can create simple Active/Passive items (adds +1d) or Consumables (+1d, improved
        position).</p>
    </div>

    <div class="form-group">
      <label>Description</label>
      <textarea name="description" rows="3" placeholder="Describe the equipment...">{{equipment.description}}</textarea>
    </div>

    {{else}}
    {{!-- Standard Form --}}
    <div class="form-row">
      <div class="form-group">
        <label>Name <span class="required">*</span></label>
        <input type="text" name="name" value="{{equipment.name}}" maxlength="50" required />
        <p class="help-text">Equipment name (max 50 chars)</p>
      </div>

      <div class="form-group">
        <label>Tier <span class="required">*</span></label>
        <select name="tier" {{#unless canEditTier}}disabled{{/unless}}>
          {{#each tiers}}
          <option value="{{this}}" {{#if (eq this ../equipment.tier)}}selected{{/if}}>{{capitalize this}}</option>
          {{/each}}
        </select>
        <p class="help-text">
          Common (Standard), Rare (1M), Epic (Story)
          {{#unless isGM}}
          {{#unless canEditTier}}
          <br /><span class="warning-text">‚ö†Ô∏è Common only</span>
          {{/unless}}
          {{/unless}}
        </p>
      </div>
    </div>

    {{!-- Category and Slots side-by-side --}}
    <div class="form-row">
      <div class="form-group">
        <label>Category <span class="required">*</span></label>
        <select name="category" required>
          {{#each categories}}
          <option value="{{this}}" {{#if (eq this ../equipment.category)}}selected{{/if}}>{{capitalize this}}</option>
          {{/each}}
        </select>
        <p class="help-text">
          Active (Weapons/Tools), Passive (Armor/Implants), Consumable
        </p>
      </div>

      <div class="form-group">
        <label>Slots <span class="required">*</span></label>
        <input type="number" name="slots" value="{{#if equipment.slots}}{{equipment.slots}}{{else}}1{{/if}}" min="1"
          required />
        <p class="help-text">Load slots (min 1, usually 1-2)</p>
      </div>
    </div>

    <div class="form-group">
      <label>Description</label>
      <textarea name="description" rows="3" placeholder="Describe the equipment...">{{equipment.description}}</textarea>
      <p class="help-text">Narrative details and mechanical effects.</p>
    </div>

    <div class="form-group">
      <label>Modifiers</label>
      <div class="modifiers-grid">
        <div class="modifier-field">
          <label>Dice +/-</label>
          <input type="number" name="modifiers.dice" value="{{modifiers.dice}}" placeholder="0" />
        </div>
        <div class="modifier-field">
          <label>Position +/-</label>
          <input type="number" name="modifiers.position" value="{{modifiers.position}}" placeholder="0" min="-1"
            max="1" />
        </div>
        <div class="modifier-field">
          <label>Effect +/-</label>
          <input type="number" name="modifiers.effect" value="{{modifiers.effect}}" placeholder="0" min="-1" max="1" />
        </div>
      </div>
      <p class="help-text-small">Use negative values for penalties.</p>
    </div>
    {{/if}}

  </form>

  {{!-- Action Buttons --}}
  <div class="dialog-buttons">
    <button type="button" class="secondary cancel-btn">
      <i class="fas fa-times"></i> Cancel
    </button>
    <button type="submit" class="primary save-btn">
      {{#if (eq mode 'create')}}
      <i class="fas fa-plus"></i> Create Equipment
      {{else}}
      <i class="fas fa-save"></i> Save Changes
      {{/if}}
    </button>
  </div>
</div>