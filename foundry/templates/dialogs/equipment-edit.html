<div class="equipment-edit-dialog">
  {{!-- Header --}}
  <div class="dialog-header">
    {{#if (eq mode 'create')}}
    <h2>Create Equipment</h2>
    <p class="info-notice">ğŸ“¦ Create a new equipment item for this character</p>
    {{else}}
    <h2>Edit Equipment</h2>
    <p class="info-notice">ğŸ“¦ Configure equipment stats and modifiers</p>
    {{/if}}

    {{!-- Player tier restriction warning --}}
    {{#unless isGM}}
    {{#unless canEditTier}}
    <div class="warning-notice">
      âš ï¸ You can only create or edit Common tier equipment. Rare and Epic items are GM-controlled.
    </div>
    {{/unless}}
    {{/unless}}
  </div>

  {{!-- Equipment Form --}}
  <form class="equipment-form">
    <div class="form-group">
      <label>Name <span class="required">*</span></label>
      <input type="text" name="name" value="{{equipment.name}}" maxlength="50" required />
      <p class="help-text">Equipment name (max 50 characters)</p>
    </div>

    <div class="form-group">
      <label>Tier <span class="required">*</span></label>
      <select name="tier" {{#unless canEditTier}}disabled{{/unless}}>
        {{#each tiers}}
        <option value="{{this}}" {{#if (eq this ../equipment.tier)}}selected{{/if}}>{{capitalize this}}</option>
        {{/each}}
      </select>
      <p class="help-text">
        <strong>Common:</strong> Standard gear, freely available<br />
        <strong>Rare:</strong> Requires 1M on first use (between Resets)<br />
        <strong>Epic:</strong> Must be earned through story
        {{#unless isGM}}
        {{#unless canEditTier}}
        <br /><strong>âš ï¸ Players can only create Common tier equipment</strong>
        {{/unless}}
        {{/unless}}
      </p>
    </div>

    <div class="form-group">
      <label>Category <span class="required">*</span></label>
      <select name="category" required>
        {{#each categories}}
        <option value="{{this}}" {{#if (eq this ../equipment.category)}}selected{{/if}}>{{capitalize this}}</option>
        {{/each}}
      </select>
      <p class="help-text">
        <strong>Active:</strong> Player selects in roll (weapons, tools, devices)<br />
        <strong>Passive:</strong> GM approves during roll (armor, implants, augmentations)<br />
        <strong>Consumable:</strong> Single-use items (grenades, stims, medkits)
      </p>
    </div>

    <div class="form-group">
      <label>Slots <span class="required">*</span></label>
      <input type="number" name="slots" value="{{equipment.slots}}" min="1" required />
      <p class="help-text">Load slots occupied (minimum 1, default 5 slots per character)</p>
    </div>

    <div class="form-group">
      <label>Description</label>
      <textarea name="description" rows="4"
        placeholder="Describe the equipment and how it affects gameplay...">{{equipment.description}}</textarea>
      <p class="help-text">Include narrative details and mechanical effects on Position/Effect</p>
    </div>

    <div class="form-group">
      <label>Modifiers</label>
      <p class="help-text">Configure how this equipment affects rolls when used</p>
      <div class="modifiers-grid">
        <div class="modifier-field">
          <label>Position</label>
          <select name="modifiers.position">
            <option value="none" {{#if (eq equipment.modifiers.position "none" )}}selected{{/if}}>None</option>
            <option value="plus_one_step" {{#if (eq equipment.modifiers.position "plus_one_step" )}}selected{{/if}}>+1
              Step (Desperateâ†’Risky or Riskyâ†’Controlled)</option>
            <option value="minus_one_step" {{#if (eq equipment.modifiers.position "minus_one_step" )}}selected{{/if}}>-1
              Step (Controlledâ†’Risky or Riskyâ†’Desperate)</option>
          </select>
        </div>
        <div class="modifier-field">
          <label>Effect</label>
          <select name="modifiers.effect">
            <option value="none" {{#if (eq equipment.modifiers.effect "none" )}}selected{{/if}}>None</option>
            <option value="plus_one_level" {{#if (eq equipment.modifiers.effect "plus_one_level" )}}selected{{/if}}>+1
              Level (Limitedâ†’Standard or Standardâ†’Great)</option>
            <option value="minus_one_level" {{#if (eq equipment.modifiers.effect "minus_one_level" )}}selected{{/if}}>-1
              Level (Greatâ†’Standard or Standardâ†’Limited)</option>
          </select>
        </div>
        <div class="modifier-field">
          <label>Dice Pool</label>
          <input type="number" name="modifiers.dicePool" value="{{equipment.modifiers.dicePool}}" placeholder="0" />
          <p class="help-text-small">Additional dice (e.g., +1 for fine weapons)</p>
        </div>
      </div>
    </div>

  </form>

  {{!-- Action Buttons --}}
  <div class="dialog-buttons">
    <button type="button" class="secondary cancel-btn">
      <i class="fas fa-times"></i> Cancel
    </button>
    <button type="submit" class="primary save-btn">
      {{#if (eq mode 'create')}}
      <i class="fas fa-plus"></i> Create Equipment
      {{else}}
      <i class="fas fa-save"></i> Save Changes
      {{/if}}
    </button>
  </div>
</div>