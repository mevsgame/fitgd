<div class="equipment-edit-dialog">
  {{!-- Header --}}
  <div class="dialog-header">
    {{#if (eq mode 'create')}}
    <h2>Create Equipment</h2>
    <p class="info-notice">üì¶ Create a new equipment item for this character</p>
    {{else}}
    <h2>Edit Equipment</h2>
    <p class="info-notice">üì¶ Configure equipment stats and modifiers</p>
    {{/if}}

    {{!-- Player tier restriction warning --}}
    {{#unless isGM}}
    {{#unless canEditTier}}
    <div class="warning-notice">
      ‚ö†Ô∏è You can only create or edit Common tier equipment. Rare and Epic items are GM-controlled.
    </div>
    {{/unless}}
    {{/unless}}
  </div>

  {{!-- Equipment Form --}}
  <form class="equipment-form">
    {{#if restrictedCreation}}
    {{!-- Simplified Form for Players --}}
    <div class="form-row">
      <div class="form-group">
        <label>Name <span class="required">*</span></label>
        <input type="text" name="name" value="{{equipment.name}}" maxlength="50" required />
        <p class="help-text">Equipment name (max 50 characters)</p>
      </div>
      <div class="form-group">
        <label>Slots <span class="required">*</span></label>
        <input type="number" name="slots" value="{{#if equipment.slots}}{{equipment.slots}}{{else}}1{{/if}}" min="1"
          required />
        <p class="help-text">Load slots occupied</p>
      </div>
    </div>

    <div class="form-group">
      <label>Type <span class="required">*</span></label>
      <div class="modifier-field type-selection "
        style="display: flex; gap: 20px; align-items: center; padding: 10px; background: rgba(0,0,0,0.1); border-radius: 4px;">
        <label style="cursor: pointer; display: flex; align-items: center; gap: 8px;">
          <input type="radio" name="restrictedType" value="active" checked>
          <span><strong>Active</strong> (+1d check)</span>
        </label>
        <label style="cursor: pointer; display: flex; align-items: center; gap: 8px;">
          <input type="radio" name="restrictedType" value="passive">
          <span><strong>Passive</strong> (No bonus)</span>
        </label>
      </div>
      <p class="help-text">Players can create simple Active items (adds +1d) or Passive items (no mechanical bonus).</p>
    </div>

    <div class="form-group">
      <label>Description</label>
      <textarea name="description" rows="4" placeholder="Describe the equipment...">{{equipment.description}}</textarea>
    </div>

    {{else}}
    {{!-- Standard Form --}}
    <div class="form-row">
      <div class="form-group">
        <label>Name <span class="required">*</span></label>
        <input type="text" name="name" value="{{equipment.name}}" maxlength="50" required />
        <p class="help-text">Equipment name (max 50 characters)</p>
      </div>

      <div class="form-group">
        <label>Tier <span class="required">*</span></label>
        <select name="tier" {{#unless canEditTier}}disabled{{/unless}}>
          {{#each tiers}}
          <option value="{{this}}" {{#if (eq this ../equipment.tier)}}selected{{/if}}>{{capitalize this}}</option>
          {{/each}}
        </select>
        <p class="help-text">
          <strong>Common:</strong> Standard gear<br />
          <strong>Rare:</strong> Requires 1M on first use<br />
          <strong>Epic:</strong> Must be earned through story
          {{#unless isGM}}
          {{#unless canEditTier}}
          <br /><strong>‚ö†Ô∏è Players: Common only</strong>
          {{/unless}}
          {{/unless}}
        </p>
      </div>
    </div>

    {{!-- Category and Slots side-by-side --}}
    <div class="form-row">
      <div class="form-group">
        <label>Category <span class="required">*</span></label>
        <select name="category" required>
          {{#each categories}}
          <option value="{{this}}" {{#if (eq this ../equipment.category)}}selected{{/if}}>{{capitalize this}}</option>
          {{/each}}
        </select>
        <p class="help-text">
          <strong>Active:</strong> Player selects (weapons, tools)<br />
          <strong>Passive:</strong> GM approves (armor, implants)<br />
          <strong>Consumable:</strong> Single-use items (stims, grenades)
        </p>
      </div>

      <div class="form-group">
        <label>Slots <span class="required">*</span></label>
        <input type="number" name="slots" value="{{#if equipment.slots}}{{equipment.slots}}{{else}}1{{/if}}" min="1"
          required />
        <p class="help-text">Load slots occupied (minimum 1, default 5 slots per character)</p>
      </div>
    </div>

    <div class="form-group">
      <label>Description</label>
      <textarea name="description" rows="4"
        placeholder="Describe the equipment and how it affects gameplay...">{{equipment.description}}</textarea>
      <p class="help-text">Include narrative details and mechanical effects on Position/Effect</p>
    </div>

    <div class="form-group">
      <label>Modifiers</label>
      <p class="help-text">Configure how this equipment affects rolls when used (use negative values for penalties)</p>
      <div class="modifiers-grid">
        <div class="modifier-field">
          <label>Dice Modifier</label>
          <input type="number" name="modifiers.dice" value="{{modifiers.dice}}" placeholder="0" />
          <p class="help-text-small">Additional dice in pool (positive = bonus, negative = penalty)</p>
        </div>
        <div class="modifier-field">
          <label>Position Modifier</label>
          <input type="number" name="modifiers.position" value="{{modifiers.position}}" placeholder="0" min="-1"
            max="1" />
          <p class="help-text-small">Position steps (positive = improve, negative = worsen)</p>
        </div>
        <div class="modifier-field">
          <label>Effect Modifier</label>
          <input type="number" name="modifiers.effect" value="{{modifiers.effect}}" placeholder="0" min="-1" max="1" />
          <p class="help-text-small">Effect levels (positive = improve, negative = reduce)</p>
        </div>
      </div>
    </div>
    {{/if}}

  </form>

  {{!-- Action Buttons --}}
  <div class="dialog-buttons">
    <button type="button" class="secondary cancel-btn">
      <i class="fas fa-times"></i> Cancel
    </button>
    <button type="submit" class="primary save-btn">
      {{#if (eq mode 'create')}}
      <i class="fas fa-plus"></i> Create Equipment
      {{else}}
      <i class="fas fa-save"></i> Save Changes
      {{/if}}
    </button>
  </div>
</div>