<div class="equipment-edit-dialog">
  {{!-- Header --}}
  <div class="dialog-header">
    {{#if (eq mode 'create')}}
    <p class="info-notice">{{localize 'FITGD.Dialogs.EquipmentEdit.InfoCreate'}}</p>
    {{else}}
    <p class="info-notice">{{localize 'FITGD.Dialogs.EquipmentEdit.InfoEdit'}}</p>
    {{/if}}

    {{!-- Player tier restriction warning --}}
    {{#unless isGM}}
    {{#unless canEditTier}}
    <div class="warning-notice">
      {{localize 'FITGD.Dialogs.EquipmentEdit.TierWarning'}}
    </div>
    {{/unless}}
    {{/unless}}
  </div>

  {{!-- Equipment Form --}}
  <form class="equipment-form">
    {{#if restrictedCreation}}
    {{!-- Simplified Form for Players --}}
    <div class="form-row">
      <div class="form-group">
        <label>{{localize 'FITGD.Dialogs.EquipmentEdit.LabelName'}} <span class="required">*</span></label>
        <input type="text" name="name" value="{{equipment.name}}" maxlength="50" required
          placeholder="{{localize 'FITGD.Dialogs.EquipmentEdit.PlaceholderName'}}" />
        <p class="help-text">{{localize 'FITGD.Dialogs.EquipmentEdit.PlaceholderName'}}</p>
      </div>
      <div class="form-group">
        <label>{{localize 'FITGD.Dialogs.EquipmentEdit.LabelSlots'}} <span class="required">*</span></label>
        <input type="number" name="slots" value="{{#if equipment.slots}}{{equipment.slots}}{{else}}1{{/if}}" min="1"
          required />
        <p class="help-text">{{localize 'FITGD.Dialogs.EquipmentEdit.PlaceholderSlots'}}</p>
      </div>
    </div>

    <div class="form-group">
      <label>{{localize 'FITGD.Dialogs.EquipmentEdit.LabelType'}} <span class="required">*</span></label>
      <div class="type-selection">
        <label class="type-option">
          <input type="radio" name="restrictedType" value="active" checked>
          <div>
            <strong>{{localize 'FITGD.Equipment.Active'}}</strong> <span style="color: #4caf50">{{localize
              'FITGD.Dialogs.EquipmentEdit.ActiveBonus'}}</span>
          </div>
        </label>
        <label class="type-option">
          <input type="radio" name="restrictedType" value="passive">
          <div>
            <strong>{{localize 'FITGD.Equipment.Passive'}}</strong> <span style="color: #4caf50">{{localize
              'FITGD.Dialogs.EquipmentEdit.PassiveBonus'}}</span>
          </div>
        </label>
        <label class="type-option">
          <input type="radio" name="restrictedType" value="consumable">
          <div>
            <strong>{{localize 'FITGD.Equipment.Consumable'}}</strong> <span style="color: #2196f3">{{localize
              'FITGD.Dialogs.EquipmentEdit.ConsumableBonus'}}</span>
          </div>
        </label>
      </div>
      <p class="help-text">{{localize 'FITGD.Dialogs.EquipmentEdit.PlayerHelp'}}</p>
    </div>

    <div class="form-group">
      <label>{{localize 'FITGD.Dialogs.EquipmentEdit.LabelDescription'}}</label>
      <textarea name="description" rows="3"
        placeholder="{{localize 'FITGD.Dialogs.EquipmentEdit.PlaceholderDescription'}}">{{equipment.description}}</textarea>
    </div>

    {{else}}
    {{!-- Standard Form --}}
    <div class="form-row">
      <div class="form-group">
        <label>{{localize 'FITGD.Dialogs.EquipmentEdit.LabelName'}} <span class="required">*</span></label>
        <input type="text" name="name" value="{{equipment.name}}" maxlength="50" required />
        <p class="help-text">{{localize 'FITGD.Dialogs.EquipmentEdit.PlaceholderName'}}</p>
      </div>

      <div class="form-group">
        <label>{{localize 'FITGD.Dialogs.EquipmentEdit.LabelTier'}} <span class="required">*</span></label>
        <select name="tier" {{#unless canEditTier}}disabled{{/unless}}>
          {{#each tiers}}
          <option value="{{this}}" {{#if (eq this ../equipment.tier)}}selected{{/if}}>{{capitalize this}}</option>
          {{/each}}
        </select>
        <p class="help-text">
          {{localize 'FITGD.Dialogs.EquipmentEdit.HelpTier'}}
          {{#unless isGM}}
          {{#unless canEditTier}}
          <br /><span class="warning-text">{{localize 'FITGD.Dialogs.EquipmentEdit.TierCommonOnly'}}</span>
          {{/unless}}
          {{/unless}}
        </p>
      </div>
    </div>

    {{!-- Category and Slots side-by-side --}}
    <div class="form-row">
      <div class="form-group">
        <label>{{localize 'FITGD.Dialogs.EquipmentEdit.LabelCategory'}} <span class="required">*</span></label>
        <select name="category" required>
          {{#each categories}}
          <option value="{{this}}" {{#if (eq this ../equipment.category)}}selected{{/if}}>{{capitalize this}}</option>
          {{/each}}
        </select>
        <p class="help-text">
          {{localize 'FITGD.Dialogs.EquipmentEdit.HelpCategory'}}
        </p>
      </div>

      <div class="form-group">
        <label>{{localize 'FITGD.Dialogs.EquipmentEdit.LabelSlots'}} <span class="required">*</span></label>
        <input type="number" name="slots" value="{{#if equipment.slots}}{{equipment.slots}}{{else}}1{{/if}}" min="1"
          required />
        <p class="help-text">{{localize 'FITGD.Dialogs.EquipmentEdit.PlaceholderSlots'}}</p>
      </div>
    </div>

    <div class="form-group">
      <label>{{localize 'FITGD.Dialogs.EquipmentEdit.LabelDescription'}}</label>
      <textarea name="description" rows="3"
        placeholder="{{localize 'FITGD.Dialogs.EquipmentEdit.PlaceholderDescription'}}">{{equipment.description}}</textarea>
      <p class="help-text">Narrative details and mechanical effects.</p>
    </div>

    <div class="form-group">
      <label>{{localize 'FITGD.Dialogs.EquipmentEdit.LabelModifiers'}}</label>
      <div class="modifiers-grid">
        <div class="modifier-field">
          <label>{{localize 'FITGD.Dialogs.EquipmentEdit.LabelDice'}}</label>
          <input type="number" name="modifiers.dice" value="{{modifiers.dice}}" placeholder="0" />
        </div>
        <div class="modifier-field">
          <label>{{localize 'FITGD.Dialogs.EquipmentEdit.LabelPosition'}}</label>
          <input type="number" name="modifiers.position" value="{{modifiers.position}}" placeholder="0" min="-1"
            max="1" />
        </div>
        <div class="modifier-field">
          <label>{{localize 'FITGD.Dialogs.EquipmentEdit.LabelEffect'}}</label>
          <input type="number" name="modifiers.effect" value="{{modifiers.effect}}" placeholder="0" min="-1" max="1" />
        </div>
      </div>
      <p class="help-text-small">{{localize 'FITGD.Dialogs.EquipmentEdit.HelpNegative'}}</p>
    </div>
    {{/if}}

  </form>

  {{!-- Action Buttons --}}
  <div class="dialog-buttons">
    <button type="button" class="secondary cancel-btn">
      <i class="fas fa-times"></i> {{localize 'FITGD.Global.Cancel'}}
    </button>
    <button type="submit" class="primary save-btn">
      {{#if (eq mode 'create')}}
      <i class="fas fa-plus"></i> {{localize 'FITGD.Dialogs.EquipmentEdit.BtnCreate'}}
      {{else}}
      <i class="fas fa-save"></i> {{localize 'FITGD.Dialogs.EquipmentEdit.BtnSave'}}
      {{/if}}
    </button>
  </div>
</div>