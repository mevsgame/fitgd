<form class="{{cssClass}} flexcol" autocomplete="off">

  {{!-- Sheet Header --}}
  <header class="sheet-header">
    <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" height="100" width="100"/>
    <div class="header-fields">
      <h1 class="charname"><input name="name" type="text" value="{{actor.name}}" placeholder="Name"/></h1>
      <div class="resource">
        <label>Rally Available</label>
        <input type="checkbox" name="system.rallyAvailable" {{checked system.rallyAvailable}} disabled/>
      </div>
    </div>
  </header>

  {{!-- Sheet Tab Navigation --}}
  <nav class="sheet-tabs tabs" data-group="primary">
    <a class="item" data-tab="actions">Actions</a>
    <a class="item" data-tab="traits">Traits</a>
    <a class="item" data-tab="harm">Harm</a>
    <a class="item" data-tab="equipment">Equipment</a>
  </nav>

  {{!-- Sheet Body --}}
  <section class="sheet-body">

    {{!-- Actions Tab --}}
    <div class="tab actions" data-group="primary" data-tab="actions">
      <h2>Action Ratings</h2>
      <div class="actions-grid">
        {{#each system.actionDots as |dots action|}}
        <div class="action-row">
          <label>{{action}}</label>
          <div class="action-dots">
            {{#times 4}}
              <span class="dot {{#if (lte this ../dots)}}filled{{/if}}"></span>
            {{/times}}
          </div>
          <span class="action-value">{{dots}}</span>
        </div>
        {{/each}}
      </div>

      <div class="action-buttons">
        <button class="flashback-btn" type="button">
          <i class="fas fa-history"></i> Flashback
        </button>
      </div>
    </div>

    {{!-- Traits Tab --}}
    <div class="tab traits" data-group="primary" data-tab="traits">
      <div class="traits-header">
        <h2>Traits</h2>
        <button class="add-trait-btn" type="button">
          <i class="fas fa-plus"></i> Add Trait
        </button>
      </div>

      <div class="traits-list">
        {{#each system.traits as |trait|}}
        <div class="trait-item {{#if trait.disabled}}disabled{{/if}}">
          <div class="trait-header">
            <h4>{{trait.name}}</h4>
            <span class="trait-category">{{trait.category}}</span>
          </div>
          {{#if trait.description}}
          <p class="trait-description">{{trait.description}}</p>
          {{/if}}
          <div class="trait-actions">
            {{#unless trait.disabled}}
            <button class="trait-lean-btn" type="button" data-trait-id="{{trait.id}}">
              <i class="fas fa-arrow-up"></i> Lean Into (+1 Momentum)
            </button>
            {{/unless}}
            {{#if trait.disabled}}
            <span class="trait-status"><i class="fas fa-times-circle"></i> Disabled</span>
            {{/if}}
          </div>
        </div>
        {{/each}}
      </div>

      <div class="rally-section">
        <button class="use-rally-btn" type="button" {{#unless system.rallyAvailable}}disabled{{/unless}}>
          <i class="fas fa-heartbeat"></i> Use Rally
        </button>
        <p class="help-text">Rally is available at 0-3 Momentum and re-enables a disabled trait.</p>
      </div>
    </div>

    {{!-- Harm Tab --}}
    <div class="tab harm" data-group="primary" data-tab="harm">
      <div class="harm-header">
        <h2>Harm Clocks</h2>
        <button class="add-harm-btn" type="button">
          <i class="fas fa-plus"></i> Take Harm
        </button>
      </div>

      <div class="harm-clocks">
        {{#each system.harmClocks as |clock|}}
        <div class="clock-item harm-clock">
          <h4>{{clock.subtype}}</h4>
          <div class="clock-display">
            <div class="clock-segments">
              {{#times clock.maxSegments}}
                <span class="clock-segment {{#if (lt this ../clock.segments)}}filled{{/if}}"
                      data-clock-id="{{../clock.id}}"
                      data-segment="{{this}}"
                      data-current-segments="{{../clock.segments}}">
                </span>
              {{/times}}
            </div>
            <span class="clock-value">{{clock.segments}}/{{clock.maxSegments}}</span>
          </div>
        </div>
        {{/each}}

        {{#unless system.harmClocks}}
        <p class="no-clocks">No harm taken yet.</p>
        {{/unless}}
      </div>
    </div>

    {{!-- Equipment Tab --}}
    <div class="tab equipment" data-group="primary" data-tab="equipment">
      <h2>Equipment</h2>
      <div class="equipment-list">
        {{#each system.equipment as |item|}}
        <div class="equipment-item tier-{{item.tier}}">
          <h4>{{item.name}}</h4>
          <span class="equipment-tier">{{item.tier}}</span>
          {{#if item.description}}
          <p>{{item.description}}</p>
          {{/if}}
        </div>
        {{/each}}

        {{#unless system.equipment}}
        <p class="no-equipment">No equipment.</p>
        {{/unless}}
      </div>
    </div>

  </section>
</form>
