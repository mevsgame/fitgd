<form class="{{cssClass}} flexcol" autocomplete="off">

  {{!-- Sheet Header --}}
  <header class="sheet-header">
    <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" height="100" width="100" />
    <div class="header-fields">
      <h1 class="charname"><input name="name" type="text" value="{{actor.name}}"
          placeholder="{{localize 'FITGD.Global.Name'}}" /></h1>
      <div class="resource">
        <label class="allocation-label">{{localize "FITGD.Character.RallyAvailable"}}</label>
        <input type="checkbox" name="system.rallyAvailable" {{checked system.rallyAvailable}} {{#unless
          editable}}disabled{{/unless}} />
      </div>
    </div>
  </header>

  {{!-- Sheet Tab Navigation --}}
  <nav class="sheet-tabs tabs" data-group="primary">
    <a class="item" data-tab="approaches">{{localize "FITGD.Character.Approaches"}}</a>
    <a class="item" data-tab="traits">{{localize "FITGD.Character.Traits"}}</a>
    <a class="item" data-tab="harm">{{localize "FITGD.Character.Harm"}}</a>
    <a class="item" data-tab="equipment">{{localize "FITGD.Character.Equipment"}}</a>
  </nav>

  {{!-- Sheet Body --}}
  <section class="sheet-body">

    {{!-- Approaches Tab --}}
    <div class="tab approaches" data-group="primary" data-tab="approaches">
      <div class="approaches-header">
        <h2>{{localize "FITGD.Character.Approaches"}}</h2>
        <div class="header-buttons">
          <button class="take-action-btn draggable" type="button" draggable="true" data-action-type="take-action"
            title="{{localize 'FITGD.Buttons.TakeActionTooltip'}}">
            <i class="fas fa-cube"></i> {{localize "FITGD.Buttons.TakeAction"}}
          </button>
          <button class="toggle-edit-btn" type="button">
            {{#if editMode}}
            <i class="fas fa-save"></i> {{localize "FITGD.Buttons.Save"}}
            {{else}}
            <i class="fas fa-edit"></i> {{localize "FITGD.Buttons.Edit"}}
            {{/if}}
          </button>
        </div>
      </div>

      {{!-- Dot Allocation Display --}}
      <div class="dot-allocation-display">
        <div class="allocation-track">
          <span class="allocation-label">{{localize "FITGD.Character.Dots"}}:</span>
          {{#times system.totalApproachDots}}
          <span class="allocation-dot {{#if (lt this ../system.allocatedApproachDots)}}filled{{/if}}"></span>
          {{/times}}
          <span class="allocation-text">
            {{system.allocatedApproachDots}}/{{system.totalApproachDots}}
            {{#if (eq system.unallocatedApproachDots 0)}}
            <i class="fas fa-check-circle allocation-complete"></i>
            {{else}}
            ({{system.unallocatedApproachDots}} {{localize "FITGD.Character.ToAllocate"}})
            {{/if}}
          </span>
        </div>
      </div>

      {{#if editMode}}
      <p class="help-text edit-mode-active">
        <i class="fas fa-edit"></i> {{localize "FITGD.Character.EditModeActive"}}
      </p>
      {{else}}
      <p class="help-text">{{localize "FITGD.Character.EditModeHint"}}</p>
      {{/if}}

      <div class="approaches-grid">
        {{#each system.approaches}}
        <div class="approach-row">
          <label class="approach-label">
            {{localize (concat 'FITGD.Approaches.' (capitalize approach))}}
          </label>
          <div class="approach-dots" data-approach="{{approach}}">
            {{#times 4}}
            <span class="dot {{#if (lt this ../dots)}}filled{{/if}}" data-approach="{{../approach}}"
              data-value="{{add this 1}}" title="Set {{../approach}} to {{add this 1}} dots"></span>
            {{/times}}
          </div>
          <span class="approach-value">{{dots}}</span>
        </div>
        {{/each}}
      </div>

    </div>

    {{!-- Traits Tab --}}
    <div class="tab traits" data-group="primary" data-tab="traits">
      <div class="traits-header">
        <h2>{{localize "FITGD.Character.Traits"}}</h2>
        <div class="header-buttons">
          <button class="add-trait-btn" type="button">
            <i class="fas fa-plus"></i> {{localize "FITGD.Traits.Add"}}
          </button>
        </div>
      </div>

      <div class="traits-list">
        {{#each system.traits as |trait|}}
        <div class="trait-item {{#if trait.disabled}}disabled{{/if}}">
          <div class="trait-header">
            <h4 class="trait-name {{#if @root.editable}}editable{{/if}}" data-trait-id="{{trait.id}}"
              contenteditable="{{@root.editable}}" spellcheck="false">{{trait.name}}</h4>
            <div class="trait-header-right">
              <span class="trait-category">{{trait.localizedCategory}}</span>
            </div>

            {{#if @root.editable}}
            <div class="trait-header-right">
              <button class="delete-trait-btn" type="button" data-trait-id="{{trait.id}}"
                title="{{localize 'FITGD.Traits.Delete'}}">
                <i class="fas fa-trash"></i>
              </button>

            </div>
            {{/if}}
          </div>
          {{#if @root.editable}}
          <p class="trait-description editable" data-trait-id="{{trait.id}}" contenteditable="true"
            placeholder="{{localize 'FITGD.Traits.DescriptionPlaceholder'}}">{{trait.description}}</p>
          {{else}}
          {{#if trait.description}}
          <p class="trait-description">{{trait.description}}</p>
          {{/if}}
          {{/if}}
        </div>
        {{/each}}
      </div>
    </div>

    {{!-- Harm Tab --}}
    <div class="tab harm" data-group="primary" data-tab="harm">
      <div class="harm-header">
        <h2>{{localize "FITGD.Character.HarmClocks"}}</h2>
        <button class="add-harm-btn" type="button">
          <i class="fas fa-plus"></i> {{localize "FITGD.Harm.Take"}}
        </button>
      </div>

      <div class="harm-clocks">
        {{#each system.harmClocks as |clock|}}
        <div class="clock-item harm-clock" data-clock-id="{{clock.id}}">
          <div class="clock-header">
            <h4 class="clock-name {{#if @root.editable}}editable{{/if}}" data-clock-id="{{clock.id}}"
              contenteditable="{{@root.editable}}">{{clock.subtype}}</h4>
            {{#if @root.editable}}
            <button class="delete-clock-btn" type="button" data-clock-id="{{clock.id}}"
              title="{{localize 'FITGD.Clocks.Delete'}}">
              <i class="fas fa-trash"></i>
            </button>
            {{/if}}
          </div>
          <div class="clock-display">
            {{clockSVG clock width="100px" height="100px" class="harm-clock-svg"}}
          </div>
          <div class="clock-controls">
            {{#if @root.editable}}
            <input type="number" class="clock-value-input" data-clock-id="{{clock.id}}" value="{{clock.segments}}"
              min="0" max="{{clock.maxSegments}}" title="{{localize 'FITGD.Clocks.ValueTooltip'}}" />
            {{else}}
            <span class="clock-value">{{clock.segments}}/{{clock.maxSegments}}</span>
            {{/if}}
          </div>
        </div>
        {{/each}}

        {{#unless system.harmClocks}}
        <p class="no-clocks">{{localize "FITGD.Character.NoHarm"}}</p>
        {{/unless}}
      </div>

      {{!-- Addiction Clock Section --}}
      {{#if system.addictionClock}}
      <div class="addiction-clock-section">
        <h3>ðŸ’‰ {{localize "FITGD.Crew.AddictionClock"}}</h3>
        <div class="clock-item addiction-clock" data-clock-id="{{system.addictionClock.id}}">
          <div class="clock-display">
            {{clockSVG system.addictionClock width="120px" height="120px" class="addiction-clock-svg"}}
          </div>
          <div class="clock-controls">
            {{#if @root.editable}}
            <input type="number" class="clock-value-input" data-clock-id="{{system.addictionClock.id}}"
              value="{{system.addictionClock.segments}}" min="0" max="{{system.addictionClock.maxSegments}}"
              title="{{localize 'FITGD.Clocks.ValueTooltip'}}" />
            {{else}}
            <span class="clock-value">{{system.addictionClock.segments}}/{{system.addictionClock.maxSegments}}</span>
            {{/if}}
          </div>
          {{#if (gte system.addictionClock.segments system.addictionClock.maxSegments)}}
          <div class="addiction-warning">
            <i class="fas fa-exclamation-triangle"></i> {{localize "FITGD.Crew.Addicted"}}
          </div>
          {{/if}}
        </div>
      </div>
      {{/if}}
    </div>

    {{!-- Equipment Tab --}}
    <div class="tab equipment" data-group="primary" data-tab="equipment">
      <div class="equipment-header">
        <h2>{{localize "FITGD.Character.Equipment"}}</h2>
        <div class="equipment-header-info">
          <span class="load-display">
            <i class="fas fa-weight"></i>
            {{localize "FITGD.Character.Load"}}: <span class="load-value">{{loadUsed}}</span>/<span
              class="load-limit">{{#if
              system.loadLimit}}{{system.loadLimit}}{{else}}5{{/if}}</span> {{localize "FITGD.Character.Slots"}}
          </span>
          <div class="action-buttons">
            <button class="create-equipment-btn" type="button">
              <i class="fas fa-hammer"></i> {{localize "FITGD.Character.CreateEquipment"}}
            </button>
            <button class="add-equipment-btn" type="button">
              <i class="fas fa-search"></i> {{localize "FITGD.Character.BrowseEquipment"}}
            </button>
          </div>
        </div>
      </div>

      {{#if system.equipment}}
      <div class="equipment-categories">
        {{!-- Active Equipment Section --}}
        {{#if (hasEquipmentByCategory system.equipment "active")}}
        <div class="equipment-category-section active-section">
          <div class="category-label">
            <i class="fas fa-crossed-swords"></i> {{localize "FITGD.Character.ActiveEquipment"}}
          </div>
          <div class="equipment-list">
            {{#each system.equipment as |item|}}
            {{#if (eq item.category "active")}}
            {{> equipment-row-view item=item config=(getConfigForContext "character-sheet")}}
            <div class="equipment-actions">
              <button class="edit-equipment-btn" type="button" data-equipment-id="{{item.id}}"
                title="{{localize 'FITGD.Global.Edit'}}">
                <i class="fas fa-edit"></i>
              </button>
              <button class="delete-equipment-btn" type="button" data-equipment-id="{{item.id}}"
                title="{{localize 'FITGD.Global.Remove'}}">
                <i class="fas fa-trash"></i>
              </button>
            </div>
            {{/if}}
            {{/each}}
          </div>
        </div>
        {{/if}}

        {{!-- Passive Equipment Section --}}
        {{#if (hasEquipmentByCategory system.equipment "passive")}}
        <div class="equipment-category-section passive-section">
          <div class="category-label">
            <i class="fas fa-shield-alt"></i> {{localize "FITGD.Character.PassiveEquipment"}}
          </div>
          <div class="equipment-list">
            {{#each system.equipment as |item|}}
            {{#if (eq item.category "passive")}}
            {{> equipment-row-view item=item config=(getConfigForContext "character-sheet")}}
            <div class="equipment-actions">
              <button class="edit-equipment-btn" type="button" data-equipment-id="{{item.id}}"
                title="{{localize 'FITGD.Global.Edit'}}">
                <i class="fas fa-edit"></i>
              </button>
              <button class="delete-equipment-btn" type="button" data-equipment-id="{{item.id}}"
                title="{{localize 'FITGD.Global.Remove'}}">
                <i class="fas fa-trash"></i>
              </button>
            </div>
            {{/if}}
            {{/each}}
          </div>
        </div>
        {{/if}}

        {{!-- Consumable Equipment Section --}}
        {{#if (hasEquipmentByCategory system.equipment "consumable")}}
        <div class="equipment-category-section consumable-section">
          <div class="category-label">
            <i class="fas fa-vial"></i> {{localize "FITGD.Character.ConsumableEquipment"}}
          </div>
          <div class="equipment-list">
            {{#each system.equipment as |item|}}
            {{#if (eq item.category "consumable")}}
            {{> equipment-row-view item=item config=(getConfigForContext "character-sheet")}}
            <div class="equipment-actions">
              <button class="edit-equipment-btn" type="button" data-equipment-id="{{item.id}}"
                title="{{localize 'FITGD.Global.Edit'}}">
                <i class="fas fa-edit"></i>
              </button>
              <button class="delete-equipment-btn" type="button" data-equipment-id="{{item.id}}"
                title="{{localize 'FITGD.Global.Remove'}}">
                <i class="fas fa-trash"></i>
              </button>
            </div>
            {{/if}}
            {{/each}}
          </div>
        </div>
        {{/if}}
      </div>
      {{else}}
      <p class="no-equipment">
        <i class="fas fa-inbox"></i> {{localize "FITGD.Character.NoEquipment"}}
      </p>
      {{/if}}
    </div>

  </section>
</form>